<?xml version="1.0" encoding="utf-8"?>
<androidx.drawerlayout.widget.DrawerLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/navigation_drawer_layout"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context="com.fsck.k9.activity.MainActivity"
    >
    <!--
     As the navigation of Message List (MessageHomeActivity) is based on the ViewSwitcher,
     which just toggle the visibility of existing views rather than creating/destroying the
     Fragments, the Fragment's lifecycle methods, such as onViewCreated, are not properly called.

     Modern layouts (ConstraintLayout, CoordinatorLayout) optimize measurement during visibility
     toggles and WindowInsets updates, sometimes causing a transient layout pass with incorrect bounds.
     The RecyclerView incorrectly treats this pass as a successful update and marks its state as "clean".
     Consequently, it fails to trigger onBindViewHolder when the view is fully restored, leaving the
     UI stuck displaying the previous stale state instead of the new data.

     RelativeLayout is used to enforce strict vertical dependencies. By using layout_below, it
     ensures the Toolbar is measured before the container. This prevents the race condition and forces
     the RecyclerView to recognize its actual bounds, ensuring the adapter binds correctly without
     performance-heavy requestLayout() calls.

     Until we move this screen to use a modern navigation system, or rewrite it using Jetpack Compose,
     we need to use this workaround.
    -->
    <RelativeLayout
        android:id="@+id/coordinator_layout"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        >

        <com.google.android.material.appbar.AppBarLayout
            android:id="@+id/app_bar_layout"
            style="@style/Widget.App.AppBarLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_alignParentTop="true"
            >

            <include
                android:id="@+id/toolbar"
                layout="@layout/message_list_toolbar"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                />

        </com.google.android.material.appbar.AppBarLayout>

        <FrameLayout
            android:id="@+id/content_container"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:layout_below="@id/app_bar_layout"
            >

            <ProgressBar
                android:id="@+id/message_list_progress"
                style="?android:attr/progressBarStyleHorizontal"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:elevation="8dp"
                android:max="10000"
                android:visibility="invisible"
                />

            <LinearLayout
                android:id="@+id/container"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:baselineAligned="false"
                android:orientation="horizontal"
                >

                <androidx.fragment.app.FragmentContainerView
                    android:id="@+id/message_list_container"
                    android:layout_width="fill_parent"
                    android:layout_height="fill_parent"
                    android:layout_weight="5"
                    tools:layout="@layout/message_list_fragment"
                    />

                <View
                    android:id="@+id/message_list_divider"
                    android:layout_width="1px"
                    android:layout_height="fill_parent"
                    android:background="?attr/colorOutlineVariant"
                    tools:ignore="PxUsage"
                    />

                <androidx.fragment.app.FragmentContainerView
                    android:id="@+id/message_view_container"
                    android:layout_width="fill_parent"
                    android:layout_height="fill_parent"
                    android:layout_weight="3"
                    tools:layout="@layout/message"
                    />

            </LinearLayout>

        </FrameLayout>

    </RelativeLayout>

    <include layout="@layout/navigation_drawer_content" />

</androidx.drawerlayout.widget.DrawerLayout>
