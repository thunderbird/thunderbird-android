<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Module Structure - Thunderbird for Android - Developer Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Developer Documentation for the Thunderbird for Android project.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../assets/additional/css/last-changed.css">
        <link rel="stylesheet" href="../assets/additional/css/navigation.css">
        <link rel="stylesheet" href="../assets/additional/css/pagetoc.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="dark">Dark</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Thunderbird for Android - Developer Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/thunderbird/thunderbird-android" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/thunderbird/thunderbird-android/edit/main/./architecture/module-structure.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="-module-structure"><a class="header" href="#-module-structure">📦 Module Structure</a></h1>
<p>The Thunderbird for Android project is following a modularization approach, where the codebase is divided into multiple
distinct modules. These modules encapsulate specific functionality and can be developed, tested, and maintained
independently. This modular architecture promotes reusability, scalability, and maintainability of the codebase.</p>
<p>Each module should be split into two main parts: <strong>API</strong> and <strong>implementation</strong>. This separation provides clear
boundaries between what a module exposes to other modules and how it implements its functionality internally.</p>
<p>When a feature is complex, it can be further split into sub modules, allowing for better organization and smaller modules
for distinct functionalities within a feature domain.</p>
<p>This approach promotes:</p>
<ul>
<li><strong>Loose coupling</strong>: Modules interact through well-defined interfaces</li>
<li><strong>Interchangeable implementations</strong>: Different implementations can be swapped without affecting consumers</li>
<li><strong>Improved build times</strong>: Reduces the scope of recompilation when changes are made</li>
<li><strong>Better testability</strong>: Modules can be tested in isolation</li>
<li><strong>Clear ownership</strong>: Teams can own specific modules</li>
</ul>
<h3 id="-api-module"><a class="header" href="#-api-module">📝 API Module</a></h3>
<p>The API module defines the public contract that other modules can depend on. It should be stable, well-documented, and
change infrequently.</p>
<p>The API module contains:</p>
<ul>
<li><strong>Public interfaces</strong>: Contracts that define the module’s capabilities</li>
<li><strong>Data models</strong>: Entities that are part of the public API</li>
<li><strong>Constants and enums</strong>: Shared constants and enumeration types</li>
<li><strong>Extension functions</strong>: Utility functions that extend public types</li>
<li><strong>Navigation definitions</strong>: Navigation routes and arguments</li>
</ul>
<p>The API module should be minimal and focused on defining the contract that other modules can depend on. It should not
contain any implementation details.</p>
<h4 id="naming-convention"><a class="header" href="#naming-convention">Naming Convention</a></h4>
<p>API modules should follow the naming convention:</p>
<ul>
<li><code>feature:&lt;feature-name&gt;:api</code> for feature modules</li>
<li><code>core:&lt;core-name&gt;:api</code> for core modules</li>
</ul>
<h4 id="example-structure-for-a-feature-api-module"><a class="header" href="#example-structure-for-a-feature-api-module">Example structure for a feature API module:</a></h4>
<pre><code class="language-bash">feature:account:api
├── src/main/kotlin/net/thunderbird/feature/account/api
│   ├── AccountManager.kt (interface)
│   ├── Account.kt (entity)
│   ├── AccountNavigation.kt (interface)
│   ├── AccountType.kt (entity)
│   └── AccountExtensions.kt (extension functions)
</code></pre>
<h4 id="api-design-guidelines"><a class="header" href="#api-design-guidelines">API Design Guidelines</a></h4>
<p>When designing APIs, follow these principles:</p>
<ul>
<li><strong>Minimal surface area</strong>: Expose only what is necessary</li>
<li><strong>Immutable data</strong>: Use immutable data structures where possible</li>
<li><strong>Clear contracts</strong>: Define clear method signatures with documented parameters and return values</li>
<li><strong>Error handling</strong>: Define how errors are communicated (exceptions, result types, etc.)</li>
</ul>
<h3 id="-implementation-module"><a class="header" href="#-implementation-module">⚙️ Implementation Module</a></h3>
<p>The implementation module depends on the API module but should not be depended upon by other modules (except for
dependency injection setup).</p>
<p>The implementation module contains:</p>
<ul>
<li><strong>Interface implementations</strong>: Concrete implementations of the interfaces defined in the API module</li>
<li><strong>Internal components</strong>: Classes and functions used internally</li>
<li><strong>Data sources</strong>: Repositories, database access, network clients</li>
<li><strong>UI components</strong>: Screens, composables, and ViewModels</li>
</ul>
<h4 id="naming-convention-1"><a class="header" href="#naming-convention-1">Naming Convention</a></h4>
<p>Implementation modules should follow the naming convention:</p>
<ul>
<li><code>feature:&lt;feature-name&gt;:impl</code> for standard implementations</li>
<li><code>feature:&lt;feature-name&gt;:impl-&lt;variant&gt;</code> for variant-specific implementations</li>
<li><code>core:&lt;core-name&gt;:impl</code> for core module implementations</li>
</ul>
<h4 id="multiple-implementations"><a class="header" href="#multiple-implementations">Multiple Implementations</a></h4>
<p>When multiple implementations are needed, such as for different providers or platforms, they can be placed in separate
modules and named accordingly:</p>
<ul>
<li><code>feature:account:impl-gmail</code> - Gmail-specific implementation</li>
<li><code>feature:account:impl-yahoo</code> - Yahoo-specific implementation</li>
<li><code>feature:account:impl-noop</code> - No-operation implementation for testing</li>
</ul>
<h4 id="example-structure-for-a-variant-implementation"><a class="header" href="#example-structure-for-a-variant-implementation">Example structure for a variant implementation:</a></h4>
<pre><code class="language-bash">feature:account:impl-gmail
├── src/main/kotlin/app/thunderbird/feature/account/gmail
│   └── GmailAccountManager.kt
</code></pre>
<h4 id="clean-architecture-in-implementation-modules"><a class="header" href="#clean-architecture-in-implementation-modules">Clean Architecture in Implementation Modules</a></h4>
<p>A complex feature implementation module should apply <strong>Clean Architecture</strong> principles, separating concerns into:</p>
<ul>
<li><strong>UI Layer</strong>: Compose UI components, ViewModels, and UI state management</li>
<li><strong>Domain Layer</strong>: Use cases, domain models, and business logic</li>
<li><strong>Data Layer</strong>: Repositories, data sources, and data mapping</li>
</ul>
<pre><code class="language-bash">feature:account:impl
├── src/main/kotlin/app/thunderbird/feature/account/impl
│   ├── data/
│   │   ├── repository/
│   │   ├── datasource/
│   │   └── mapper/
│   ├── domain/
│   │   ├── repository/
│   │   ├── entity/
│   │   └── usecase/
│   └── ui/
│       ├── AccountScreen.kt
│       └── AccountViewModel.kt
</code></pre>
<h4 id="implementation-best-practices"><a class="header" href="#implementation-best-practices">Implementation Best Practices</a></h4>
<ul>
<li><strong>Internal visibility</strong>: Use the <code>internal</code> modifier for classes and functions that should not be part of the public API</li>
<li><strong>Encapsulation</strong>: Keep implementation details hidden from consumers</li>
<li><strong>Testability</strong>: Design implementations to be easily testable</li>
<li><strong>Dependency injection</strong>: Use constructor injection for dependencies</li>
<li><strong>Error handling</strong>: Implement robust error handling according to API contracts</li>
<li><strong>Performance</strong>: Consider performance implications of implementations</li>
<li><strong>Logging</strong>: Include appropriate logging for debugging and monitoring</li>
</ul>
<h3 id="-testing-module"><a class="header" href="#-testing-module">🧪 Testing Module</a></h3>
<p>Testing modules provide test implementations, utilities, and frameworks for testing other modules. They are essential for ensuring the quality and correctness of the codebase.</p>
<h4 id="contents"><a class="header" href="#contents">Contents</a></h4>
<p>The testing module contains:</p>
<ul>
<li><strong>Test utilities</strong>: Helper functions and classes for testing</li>
<li><strong>Test frameworks</strong>: Custom test frameworks and extensions</li>
<li><strong>Test fixtures</strong>: Reusable test setups and teardowns</li>
<li><strong>Test matchers</strong>: Custom matchers for assertions</li>
</ul>
<h4 id="naming-convention-2"><a class="header" href="#naming-convention-2">Naming Convention</a></h4>
<p>Testing modules should follow the naming convention:</p>
<ul>
<li><code>feature:&lt;feature-name&gt;:testing</code> for feature-specific test utilities</li>
<li><code>core:&lt;core-name&gt;:testing</code> for core test utilities</li>
<li><code>&lt;module-name&gt;:test</code> for module-specific tests</li>
</ul>
<h4 id="example-structure-for-a-testing-module"><a class="header" href="#example-structure-for-a-testing-module">Example structure for a testing module:</a></h4>
<pre><code class="language-bash">feature:account:testing
├── src/main/kotlin/app/thunderbird/feature/account/testing
│   ├── AccountTestUtils.kt
│   └── AccountTestMatchers.kt
</code></pre>
<h4 id="testing-best-practices"><a class="header" href="#testing-best-practices">Testing Best Practices</a></h4>
<ul>
<li><strong>Reusability</strong>: Create reusable test utilities and data factories</li>
<li><strong>Isolation</strong>: Tests should be isolated and not depend on external systems</li>
<li><strong>Readability</strong>: Tests should be easy to read and understand</li>
<li><strong>Maintainability</strong>: Tests should be easy to maintain and update</li>
<li><strong>Coverage</strong>: Tests should cover all critical paths and edge cases</li>
</ul>
<h3 id="-fake-module"><a class="header" href="#-fake-module">🤖 Fake Module</a></h3>
<p>Fake modules provide alternative implementations of interfaces for testing, development, or demonstration purposes. They are simpler than the real implementations and are designed to be used in controlled environments.</p>
<h4 id="contents-1"><a class="header" href="#contents-1">Contents</a></h4>
<p>The fake module contains:</p>
<ul>
<li><strong>Fake implementations</strong>: Simplified implementations of interfaces</li>
<li><strong>Generic test data</strong>: Basic, reusable sample data for testing and demonstration</li>
<li><strong>In-memory data stores</strong>: In-memory alternatives to real data stores</li>
<li><strong>Controlled behavior</strong>: Implementations with predictable, configurable behavior</li>
<li><strong>Test doubles</strong>: Mocks, stubs, and spies for testing</li>
</ul>
<div class="mdbook-alerts mdbook-alerts-important">
<p class="mdbook-alerts-title">
  <span class="mdbook-alerts-icon"></span>
  important
</p>
<p>Fake modules should be limited to the most generic data and implementations. Specific use cases or test setups should be part of the actual test, not the fake module.</p>
</div>
<h4 id="naming-convention-3"><a class="header" href="#naming-convention-3">Naming Convention</a></h4>
<p>Fake modules should follow the naming convention:</p>
<ul>
<li><code>feature:&lt;feature-name&gt;:fake</code> for feature-specific fake implementations</li>
<li><code>core:&lt;core-name&gt;:fake</code> for core fake implementations</li>
</ul>
<h4 id="example-structure-for-a-fake-module"><a class="header" href="#example-structure-for-a-fake-module">Example structure for a fake module:</a></h4>
<pre><code class="language-bash">feature:account:fake
├── src/main/kotlin/app/thunderbird/feature/account/fake
│   ├── FakeAccountRepository.kt
│   ├── FakeAccountDataSource.kt
│   ├── InMemoryAccountStore.kt
│   ├── FakeAccountManager.kt
│   └── data/
│       ├── FakeAccountData.kt
│       └── FakeAccountProfileData.kt
</code></pre>
<h4 id="fake-implementation-best-practices"><a class="header" href="#fake-implementation-best-practices">Fake Implementation Best Practices</a></h4>
<ul>
<li><strong>Simplicity</strong>: Fake implementations should be simpler than real implementations</li>
<li><strong>Deterministic behavior</strong>: Behavior should be predictable and controllable</li>
<li><strong>Configuration</strong>: Allow configuration of behavior for different test scenarios</li>
<li><strong>Visibility</strong>: Make internal state visible for testing assertions</li>
<li><strong>Performance</strong>: Fake implementations should be fast for testing efficiency</li>
<li><strong>Generic test data</strong>: Include basic, reusable test data that can be used across different tests</li>
<li><strong>Realistic but generic data</strong>: Test data should be realistic enough to be useful but generic enough to be reused</li>
<li><strong>Separation of concerns</strong>: Keep specific test scenarios and edge cases in the actual tests, not in the fake module</li>
</ul>
<h3 id="-common-module"><a class="header" href="#-common-module">🔄 Common Module</a></h3>
<p>Common modules provide shared functionality that is used by multiple modules within a feature. They contain
implementation details, utilities, and components that need to be shared between related modules but are not part of
the public API.</p>
<h4 id="contents-2"><a class="header" href="#contents-2">Contents</a></h4>
<p>The common module contains:</p>
<ul>
<li><strong>Shared utilities</strong>: Helper functions and classes used across related modules</li>
<li><strong>Internal implementations</strong>: Implementation details shared between modules</li>
<li><strong>Shared UI components</strong>: Reusable UI components specific to a feature domain</li>
<li><strong>Data repositories</strong>: Shared data storage and access implementations</li>
<li><strong>Constants and resources</strong>: Shared constants, strings, and other resources</li>
</ul>
<h4 id="naming-convention-4"><a class="header" href="#naming-convention-4">Naming Convention</a></h4>
<p>Common modules should follow the naming convention:</p>
<ul>
<li><code>feature:&lt;feature-name&gt;:common</code> for feature-specific common code</li>
<li><code>core:&lt;core-name&gt;:common</code> for core common code</li>
</ul>
<h4 id="example-structure-for-a-common-module"><a class="header" href="#example-structure-for-a-common-module">Example structure for a common module:</a></h4>
<pre><code class="language-bash">feature:account:common
├── src/main/kotlin/net/thunderbird/feature/account/common
│   ├── AccountCommonModule.kt
│   ├── data/
│   │   └── InMemoryAccountStateRepository.kt
│   ├── domain/
│   │   ├── AccountDomainContract.kt
│   │   ├── input/
│   │   │   └── NumberInputField.kt
│   │   └── entity/
│   │       ├── AccountState.kt
│   │       ├── AccountDisplayOptions.kt
│   │       └── AuthorizationState.kt
│   └── ui/
│       ├── WizardNavigationBar.kt
│       └── WizardNavigationBarState.kt
</code></pre>
<h4 id="common-module-best-practices"><a class="header" href="#common-module-best-practices">Common Module Best Practices</a></h4>
<ul>
<li><strong>Internal visibility</strong>: Use the <code>internal</code> modifier for classes and functions that should not be part of the public API</li>
<li><strong>Clear organization</strong>: Organize code into data, domain, and UI packages for better maintainability</li>
<li><strong>Shared contracts</strong>: Define clear interfaces for functionality that will be implemented by multiple modules</li>
<li><strong>Reusable components</strong>: Create UI components that can be reused across different screens within a feature</li>
<li><strong>Stateless where possible</strong>: Design components to be stateless and receive state through parameters</li>
<li><strong>Minimal dependencies</strong>: Keep dependencies to a minimum to avoid transitive dependency issues</li>
<li><strong>Documentation</strong>: Document the purpose and usage of shared components</li>
<li><strong>Avoid leaking implementation details</strong>: Don’t expose implementation details that could create tight coupling</li>
</ul>
<h2 id="-module-dependencies"><a class="header" href="#-module-dependencies">🔗 Module Dependencies</a></h2>
<p>The module dependency diagram below illustrates how different modules interact with each other in the project, showing
the dependencies and integration points between modules.</p>
<pre class="mermaid">graph TB
    subgraph APP[App Modules]
        direction TB
        APP_TB[&quot;`**:app-thunderbird**&lt;br&gt;Thunderbird for Android`&quot;]
        APP_K9[&quot;`**:app-k9mail**&lt;br&gt;K-9 Mail`&quot;]
    end

    subgraph COMMON[App Common Module]
        direction TB
        COMMON_APP[&quot;`**:app-common**&lt;br&gt;Integration Code`&quot;]
    end

    subgraph FEATURE[Feature]
        direction TB
        FEATURE1[feature:account:api]
        FEATURE2[feature:account:impl]
        FEATURE3[Feature 2]
        FEATURE_K9[Feature K-9 Only]
        FEATURE_TB[Feature TfA Only]
    end

    subgraph CORE[Core]
        direction TB
        CORE1[Core 1]
        CORE2[Core 2]
    end

    subgraph LIBRARY[Library]
        direction TB
        LIB1[Library 1]
        LIB2[Library 2]
    end

    APP_K9 --&gt; |depends on| COMMON_APP
    APP_TB --&gt; |depends on| COMMON_APP
    COMMON_APP --&gt; |integrates| FEATURE1
    COMMON_APP --&gt; |injects| FEATURE2
    FEATURE2 --&gt; FEATURE1
    COMMON_APP --&gt; |integrates| FEATURE3
    APP_K9 --&gt; |integrates| FEATURE_K9
    APP_TB --&gt; |integrates| FEATURE_TB
    FEATURE1 --&gt; |uses| CORE1
    FEATURE3 --&gt; |uses| CORE2
    FEATURE_TB --&gt; |uses| CORE1
    FEATURE_K9 --&gt; |uses| LIB2
    CORE2 --&gt; |uses| LIB1

    classDef app fill:#d9e9ff,stroke:#000000,color:#000000
    classDef app_module fill:#4d94ff,stroke:#000000,color:#000000
    classDef common fill:#e6e6e6,stroke:#000000,color:#000000
    classDef common_module fill:#999999,stroke:#000000,color:#000000
    classDef feature fill:#d9ffd9,stroke:#000000,color:#000000
    classDef feature_module fill:#33cc33,stroke:#000000,color:#000000
    classDef core fill:#e6cce6,stroke:#000000,color:#000000
    classDef core_module fill:#cc99cc,stroke:#000000,color:#000000
    classDef library fill:#fff0d0,stroke:#000000,color:#000000
    classDef library_module fill:#ffaa33,stroke:#000000,color:#000000
    classDef legacy fill:#ffe6e6,stroke:#000000,color:#000000
    classDef legacy_module fill:#ff9999,stroke:#000000,color:#000000

    linkStyle default stroke:#999,stroke-width:2px

    class APP app
    class APP_K9,APP_TB app_module
    class COMMON common
    class COMMON_APP common_module
    class FEATURE feature
    class FEATURE1,FEATURE2,FEATURE3 feature_module
    class FEATURE_K9 featureK9
    class FEATURE_TB featureTB
    class CORE core
    class CORE1,CORE2 core_module
    class LIBRARY library
    class LIB1,LIB2 library_module
</pre>
<h3 id="module-interaction-patterns"><a class="header" href="#module-interaction-patterns">Module Interaction Patterns</a></h3>
<ul>
<li><strong>App Modules</strong>: Depend on the App Common module for shared functionality and selectively integrate feature modules</li>
<li><strong>App Common</strong>: Integrates various feature modules to provide a cohesive application</li>
<li><strong>Feature Modules</strong>: Use core modules and libraries for their implementation, may depend on other feature API modules</li>
<li><strong>App-Specific Features</strong>: Some features are integrated directly by specific apps (K-9 Mail or Thunderbird)</li>
</ul>
<h3 id="dependency-rules"><a class="header" href="#dependency-rules">Dependency Rules</a></h3>
<p>These rules must be strictly followed:</p>
<ol>
<li><strong>One-Way Dependencies</strong>:
<ul>
<li>Modules should not depend on each other in a circular manner</li>
<li>Dependencies should form a directed acyclic graph (DAG)</li>
</ul>
</li>
<li><strong>API-Implementation Separation</strong>:
<ul>
<li>Modules should depend only on API modules, not implementation modules</li>
<li>Implementation modules should be referenced only in dependency injection setup</li>
</ul>
</li>
<li><strong>Feature Integration</strong>:
<ul>
<li>Features should be integrated through the App Common module, which acts as a central hub</li>
<li>Direct dependencies between feature implementations should be avoided, or limited to API modules</li>
</ul>
</li>
<li><strong>Dependency Direction</strong>:
<ul>
<li>Dependencies should flow from app modules to common, then to features, and finally to core and libraries</li>
<li>Higher-level modules should depend on lower-level modules, not vice versa</li>
</ul>
</li>
<li><strong>Minimal Dependencies</strong>:
<ul>
<li>Each module should have the minimal set of dependencies required</li>
<li>Avoid unnecessary dependencies that could lead to bloat</li>
</ul>
</li>
</ol>
<h3 id="dependency-management"><a class="header" href="#dependency-management">Dependency Management</a></h3>
<ul>
<li><strong>Explicit Dependencies</strong>: All dependencies should be explicitly declared in the module’s build file</li>
<li><strong>Transitive Dependencies</strong>: Avoid relying on transitive dependencies</li>
<li><strong>Version Management</strong>: Use centralized version management for dependencies</li>
<li><strong>Dependency Visibility</strong>: Use appropriate visibility modifiers to limit access to implementation details</li>
</ul>
<h3 id="dependency-injection"><a class="header" href="#dependency-injection">Dependency Injection</a></h3>
<ul>
<li>Use Koin for dependency injection</li>
<li>Configure module dependencies in dedicated Koin modules</li>
<li>Inject API interfaces, not implementation classes</li>
<li>Use lazy injection where appropriate to improve startup performance</li>
</ul>
<h2 id="-module-granularity"><a class="header" href="#-module-granularity">📏 Module Granularity</a></h2>
<p>Determining the right granularity for modules is crucial for maintainability and scalability. This section provides
guidelines on when to create new modules and how to structure them.</p>
<h3 id="when-to-create-a-new-module"><a class="header" href="#when-to-create-a-new-module">When to Create a New Module</a></h3>
<p>Create a new module when:</p>
<ol>
<li><strong>Distinct Functionality</strong>: The code represents a distinct piece of functionality with clear boundaries</li>
<li><strong>Reusability</strong>: The functionality could be reused across multiple features or applications</li>
<li><strong>Build Performance</strong>: Breaking down large modules improves build performance</li>
<li><strong>Testing</strong>: Isolation improves testability</li>
</ol>
<h3 id="when-to-split-a-module"><a class="header" href="#when-to-split-a-module">When to Split a Module</a></h3>
<p>Split an existing module when:</p>
<ol>
<li><strong>Size</strong>: The module has grown too large (&gt;10,000 lines of code as a rough guideline)</li>
<li><strong>Complexity</strong>: The module has become too complex with many responsibilities</li>
<li><strong>Dependencies</strong>: The module has too many dependencies</li>
<li><strong>Build Time</strong>: The module takes too long to build</li>
</ol>
<h3 id="when-to-keep-modules-together"><a class="header" href="#when-to-keep-modules-together">When to Keep Modules Together</a></h3>
<p>Keep functionality in the same module when:</p>
<ol>
<li><strong>Cohesion</strong>: The functionality is highly cohesive and tightly coupled</li>
<li><strong>Small Size</strong>: The functionality is small and simple</li>
<li><strong>Single Responsibility</strong>: The functionality represents a single responsibility</li>
</ol>
<footer id="last-change">Last change: <time datetime="2025-09-30">2025-09-30</time>, commit: <a href="https://github.com/thunderbird/thunderbird-android/commit/9cf083f">9cf083f</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../architecture/module-organization.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../architecture/feature-modules.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../architecture/module-organization.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../architecture/feature-modules.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../assets/additional/js/mermaid.min.js"></script>
        <script src="../assets/additional/js/mermaid-init.js"></script>
        <script src="../assets/additional/js/navigation.js"></script>
        <script src="../assets/additional/js/pagetoc.js"></script>



    </div>
    </body>
</html>
